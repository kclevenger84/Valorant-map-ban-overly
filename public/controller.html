
<!DOCTYPE html>
<html>
<head>
  <title>Map Ban Controller</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="controller">
  <h1>Valorant Map Ban Controller</h1>
  Team A: <input id="teamA" placeholder="Team A" value="Team A"> <br>
  Team B: <input id="teamB" placeholder="Team B" value="Team B"> <br><br>

  <div id="controls"></div>

  <script>
    const maps = ["Ascent", "Bind", "Haven", "Icebox", "Lotus", "Split", "Sunset"];
    const state = {
      bans: [],
      picks: [],
      sides: [],
    };
    const controls = document.getElementById("controls");

    function sendUpdate(map, bannedBy, pickedBy, sideChoice) {
      const data = { action: "update", map, bannedBy, pickedBy, sideChoice };
      ws.send(JSON.stringify(data));
    }

    function createButton(label, callback) {
      const btn = document.createElement("button");
      btn.textContent = label;
      btn.onclick = callback;
      return btn;
    }

    let step = 0;
    function nextStep() {
      controls.innerHTML = "";
      const teamA = document.getElementById("teamA").value;
      const teamB = document.getElementById("teamB").value;
      const remaining = maps.filter(m => !state.bans.includes(m) && !state.picks.includes(m));

      if (step === 0) {
        controls.append("Ban Phase: " + teamA);
        remaining.forEach(map => controls.appendChild(createButton(map, () => {
          state.bans.push(map);
          sendUpdate(map, teamA, null, null);
          step++; nextStep();
        })));
      } else if (step === 1) {
        controls.append("Ban Phase: " + teamB);
        remaining.forEach(map => controls.appendChild(createButton(map, () => {
          state.bans.push(map);
          sendUpdate(map, teamB, null, null);
          step++; nextStep();
        })));
      } else if (step === 2) {
        controls.append("Pick Phase: " + teamA);
        remaining.forEach(map => controls.appendChild(createButton(map, () => {
          state.picks.push(map);
          sendUpdate(map, null, teamA, null);
          step++; nextStep();
        })));
      } else if (step === 3) {
        controls.append("Side Choice: " + teamB);
        ["Attack", "Defense"].forEach(side => controls.appendChild(createButton(side, () => {
          const map = state.picks[0];
          sendUpdate(map, null, null, teamB + " chooses " + side);
          step++; nextStep();
        })));
      } else if (step === 4) {
        controls.append("Pick Phase: " + teamB);
        remaining.forEach(map => controls.appendChild(createButton(map, () => {
          state.picks.push(map);
          sendUpdate(map, null, teamB, null);
          step++; nextStep();
        })));
      } else if (step === 5) {
        controls.append("Side Choice: " + teamA);
        ["Attack", "Defense"].forEach(side => controls.appendChild(createButton(side, () => {
          const map = state.picks[1];
          sendUpdate(map, null, null, teamA + " chooses " + side);
          step++; nextStep();
        })));
      } else if (step === 6) {
        controls.append("Ban Phase: " + teamA);
        remaining.forEach(map => controls.appendChild(createButton(map, () => {
          state.bans.push(map);
          sendUpdate(map, teamA, null, null);
          step++; nextStep();
        })));
      } else if (step === 7) {
        controls.append("Ban Phase: " + teamB);
        remaining.forEach(map => controls.appendChild(createButton(map, () => {
          state.bans.push(map);
          sendUpdate(map, teamB, null, null);
          step++; nextStep();
        })));
      } else if (step === 8) {
        const lastMap = remaining[0];
        state.picks.push(lastMap);
        sendUpdate(lastMap, null, null, null);
        controls.append("Side Choice: " + teamA + " for final map (" + lastMap + ")");
        ["Attack", "Defense"].forEach(side => controls.appendChild(createButton(side, () => {
          sendUpdate(lastMap, null, null, teamA + " chooses " + side);
          controls.innerHTML = "Ban process complete.";
        })));
      }
    }

    const ws = new WebSocket("ws://" + location.hostname + ":3000");
    ws.onopen = () => nextStep();
  </script>
</body>
</html>
